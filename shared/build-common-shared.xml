<?xml version="1.0"?>
<!DOCTYPE project>

<project name="build-common-shared">
	<import file="../build-common-plugin.xml" />

	<if>
		<available file="${sdk.dir}/shared/portal-compat-shared" />
		<then>
			<property name="plugin-lib.classpath.path" refid="plugin-lib.classpath" />

			<path id="plugin-lib.classpath">
				<pathelement path="${plugin-lib.classpath.path}" />
				<pathelement location="${sdk.dir}/shared/portal-compat-shared/classes" />
			</path>

			<var name="plugin-lib.classpath.path" unset="true" />
		</then>
	</if>

	<target name="clean">
		<delete dir="classes" />

		<antcall target="build-common-plugin.clean" />
	</target>

	<target name="compile">
		<if>
			<and>
				<available file="${sdk.dir}/shared/portal-compat-shared" />
				<not>
					<equals arg1="${plugin.name}" arg2="portal-compat-shared" />
				</not>
			</and>
			<then>
				<ant dir="${sdk.dir}/shared/portal-compat-shared" target="compile" inheritAll="false" />
			</then>
		</if>
		<!-- imports for shared -->
		<if>
			<isset property="import.shared" />
			<then>
				<echo>import ${import.shared}</echo>
				<for list="${import.shared}" param="import.shared.current">
					<sequential>
						<if>
							<available file="${sdk.dir}/shared/@{import.shared.current}/src" />
							<then>
								<ant dir="${sdk.dir}/shared/@{import.shared.current}" target="jar" inheritAll="false" />

								<for param="import.shared.full.path">
									<path>
										<fileset dir="${sdk.dir}/dist" includes="@{import.shared.current}-${lp.version}.1*.jar" />
									</path>
									<sequential>
										<copy
											file="@{import.shared.full.path}"
											tofile="lib/@{import.shared.current}.jar"
										/>
									</sequential>
								</for>

								<if>
									<available file="${sdk.dir}/shared/@{import.shared.current}/lib" />
									<then>
										<copy todir="lib">
											<fileset dir="${sdk.dir}/shared/@{import.shared.current}/lib" includes="*.jar" />
										</copy>
									</then>
								</if>
							</then>
						</if>
					</sequential>
				</for>
			</then>
		</if>

		<mkdir dir="classes" />

		<copy todir="classes">
			<fileset dir="src" excludes="**/*.java" />
		</copy>

		<antcall target="compile-java">
			<param name="javac.classpathref" value="plugin.classpath" />
			<param name="javac.destdir" value="classes" />
			<param name="javac.srcdir" value="src" />
		</antcall>
	</target>

	<target name="deploy" depends="jar">
	</target>

	<target name="jar" depends="compile">
		<mkdir dir="${sdk.dir}/dist" />

		<jar
			basedir="classes"
			jarfile="${plugin.file}"
		/>
	</target>

	<target name="war">
		<antcall target="jar" />
	</target>
</project>